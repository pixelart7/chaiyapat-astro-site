---
import NoteProseSection from '@components/NoteProseSection.astro';
import NoteStage from '@components/NoteStage.astro';
import BaseLayout from './BaseLayout.astro'

import LogoGarden from 'src/assets/logo-garden.webp';

import PhInfoBold from '~icons/ph/info-bold'

const { title, created, updated, cover, abstract, unlisted, headings } = Astro.props.frontmatter || Astro.props;
---

<BaseLayout title={title} cover={cover}>
  <div class="bg-reader dark:bg-reader-dark shadow-2xl shadow-reader dark:shadow-reader-dark">
    <main class="mx-auto max-w-container pt-12">
      <div class="px-2">
        <div class="max-w-[65ch] mx-auto">
          <a href="/garden" class="text-sm hover:opacity-75">‚Üê Garden Home <img aria-hidden="true" src={LogoGarden} class="inline w-4 mb-1"></a>
        </div>
      </div>
      { (cover) &&
        <div class="max-w-[65ch] mx-auto mt-6 aspect-[1.91/1] bg-neutral-300 dark:bg-neutral-800 sm:rounded overflow-hidden border">
          <img src={cover} class="object-cover" alt={`Cover image for ${title}`} aria-hidden="true" />
        </div>
      }
      <article class="pb-12 px-2">
        <div class="max-w-container border-b border-gray-500/50 mb-12 pb-12">
          <header class="max-w-[65ch] mx-auto pt-8">
            <h1 class="font-display text-4xl font-bold">{title}</h1>
            <ul class="flex gap-3 mt-6">
              <li class="group">
                <span class="text-xs opacity-50 inline-flex items-center">
                  Stage
                  <a href="/garden/stages-of-my-note" class="opacity-0 group-hover:opacity-50 inline-flex ml-1 items-center hover:text-primary-700 dark:hover:text-primary-500" alt="Information about stages">
                    <PhInfoBold></PhInfoBold>
                  </a>
                </span>
                <NoteStage stage={0 + ((abstract) ? 1 : 0) + ((cover) ? 1 : 0)}></NoteStage>
              </li>
              {(created) && <li>
                <span class="text-xs opacity-50">Created</span>
                <div class="text-sm font-medium"><time datetime={created}>{new Date(created).toLocaleString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</time></div>
              </li>}
              {(updated) && <li>
                <span class="text-xs opacity-50">Updated</span>
                <div class="text-sm font-medium"><time datetime={updated}>{new Date(updated).toLocaleString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</time></div>
              </li>}
              {(unlisted) && <li>
                <span class="text-xs opacity-50">Publicity</span>
                <div class="text-sm font-medium">Unlisted</div>
              </li>}
            </ul>
            { (abstract) && <div class="mt-6">
                <blockquote class="italic text-sm opacity-60">
                  <span class="font-medium sr-only">Abstract:</span> {abstract}
                </blockquote>
              </div>
            }
          </header>
        </div>
        { headings.length > 0 &&
          <details class="max-w-[65ch] mx-auto mb-8 border rounded px-2 py-1 border-gray-500/30">
            <summary class="select-none font-display font-bold hover:opacity-75 cursor-pointer">Table of Contents</summary>
            <ul class="list-disc pl-8 pt-2">
              {headings.map((h) => 
                  <li class="font-display" style={`margin-left: ${h.depth - 1}em;`}>
                    <a href={`#${h.slug}`} class="hover:opacity-75 pb-1 inline-block underline">{h.text}</a>
                  </li>
                )
              }
            </ul>
          </details>
        }
        <NoteProseSection>
          <slot />
        </NoteProseSection>
      </article>
    </main>
  </div>
</BaseLayout>